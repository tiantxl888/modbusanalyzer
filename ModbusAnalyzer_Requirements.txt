Modbus Analyzer 需求说明书

1. 总体目标

本软件旨在为Modbus设备调试、参数监控与批量管理提供高效、稳定、易用的桌面工具。要求UI与业务逻辑彻底分离，所有操作可追溯、可分析，适合工程师日常调试和批量参数管理。

2. 功能模块与界面布局

2.1 主界面布局
- 顶部菜单栏
  - File: New Project, Open Project, Save Project, Import Excel, Export Excel, Exit
  - Tools: Serial Config, Language, Open Config File, Restart
  - Help: Manual, About
- 串口设置区
  - 参数项：Port、Baudrate、Data Bits、Parity、Stop Bits、Mode
  - 所有参数均为下拉选择，支持自动恢复上次设置，支持动态添加未检测到的COM口
  - 打开/关闭串口按钮（Open Port/Close Port），轮询按钮（Start Polling/Stop Polling）
- 参数表区
  - 多Tab页，自动按Excel分组，横向多组显示（如Data/Address/Value为一组，自动多组横排）
  - "All Parameters"页显示所有参数，其他Tab按分组显示
  - 表格只读，禁止直接编辑
  - 支持动态调整分组数，窗口缩放时自动重排
- 通讯日志区
  - 只显示[Send]和[Receive]数据内容，分别用亮绿色和亮黄色
  - 不显示"发送"、"接收"字样及长度信息
  - 支持右键菜单：Copy（拷贝选中内容）、Clear Log（清空日志）
  - 日志区只读，自动滚动到最新
- 状态栏
  - 实时显示串口状态、轮询状态、参数加载状态等

3. 串口与通信

3.1 串口设置
- 支持端口、波特率、数据位、校验、停止位、协议（RTU/ASCII）等参数设置
- 打开串口后，所有参数控件锁定（变灰），防止误操作
- 关闭串口后，参数控件解锁
- 串口设置自动保存到Excel的LocalSettings页，启动时自动恢复
- 若保存的COM口不在下拉框，自动添加

3.2 通信与轮询
- 支持合并连续地址批量轮询，提升效率
- 轮询线程可安全停止，UI点击"Stop Polling"时线程安全退出
- 轮询进行中，"Open Port"按钮变灰，防止误关串口
- 轮询停止后，"Start Polling"按钮恢复可用
- 轮询时只更新UI，不写回Excel，只有用户主动设置的参数才写回Excel
- 通信线程所有异常均捕获并详细记录日志

4. 参数表与数据管理

4.1 参数表格
- 支持多Tab分组，自动识别Excel中的分组与参数
- 横向多组显示，自动适应窗口宽度
- "All Parameters"页显示所有参数，其他Tab按分组显示
- 表格内容只读，禁止直接编辑
- 若Excel参数页只有一行（无有效数据），自动新增不同sheet，不弹窗提示
- 支持动态重排，窗口缩放时自动调整分组数

4.2 数据处理
- 支持多种数据类型（UNSIGNED、SIGNED、FLOAT32、HEX等）自动解码
- 轮询时自动更新"Value"列，所有分组同步刷新
- 只保存设置值，不保存实时通讯值

5. 日志与异常处理
- 日志文件采用UTF-8编码，DEBUG级别，详细记录所有操作、异常、通信细节、文件读写
- 日志分析操作放到子线程，避免UI卡死
- 所有异常均捕获并弹窗提示，详细写入日志
- 用户可通过日志定位问题，如"无响应"多为硬件或参数问题

6. 用户体验与细节
- 所有表格、参数区均只读，防止误操作
- 所有失效按钮自动变灰，防止误点
- 所有对Excel的读写操作均有详细日志
- 支持右键拷贝通讯日志内容
- 支持窗口缩放自适应
- 支持多语言预留（如需国际化可扩展）

7. 数据持久化
- 串口设置、参数分组等均持久化到Excel
- 启动时自动加载上次设置
- 只保存设置值，不保存实时通讯值

8. 兼容性与健壮性
- 支持异常COM口自动添加
- 所有线程安全退出，防止死锁
- 所有文件操作异常均有详细日志
- 支持多种Excel格式（.xlsx/.xls）

9. 典型操作流程
1. 启动程序，自动加载上次串口设置和参数表
2. 选择串口参数，点击"Open Port"打开串口，参数区锁定
3. 点击"Start Polling"开始轮询，轮询中"Open Port"按钮变灰
4. 轮询数据实时显示在表格和日志区
5. 点击"Stop Polling"安全停止轮询，轮询按钮恢复可用
6. 关闭串口，参数区解锁
7. 所有操作、异常、数据均有详细日志可查

10. 其它
- 支持配置文件一键打开、重启应用等便捷操作
- 支持参数表导入导出
- 支持多种分辨率和DPI缩放

如需补充特殊业务场景、扩展功能或有其它细节要求，请随时补充！ 